diff -urNp linux-2/arch/i386/kernel/apic.c linux-200/arch/i386/kernel/apic.c
--- linux-2/arch/i386/kernel/apic.c	
+++ linux-200/arch/i386/kernel/apic.c	
@@ -1179,9 +1179,10 @@ int __init APIC_init_uniprocessor (void)
 	if (nmi_watchdog == NMI_LOCAL_APIC)
 		check_nmi_watchdog();
 #ifdef CONFIG_X86_IO_APIC
-	if (smp_found_config)
-		if (!skip_ioapic_setup && nr_ioapics)
-			setup_IO_APIC();
+	if (smp_found_config && !skip_ioapic_setup && nr_ioapics) {
+		setup_IO_APIC();
+	} else
+		nr_ioapics = 0;
 #endif
 	setup_APIC_clocks();
 
diff -urNp linux-2/arch/i386/kernel/smpboot.c linux-200/arch/i386/kernel/smpboot.c
--- linux-2/arch/i386/kernel/smpboot.c	
+++ linux-200/arch/i386/kernel/smpboot.c	
@@ -1210,8 +1210,10 @@ void __init smp_boot_cpus(void)
 	 * Here we can be sure that there is an IO-APIC in the system. Let's
 	 * go and set it up:
 	 */
-	if (!skip_ioapic_setup && nr_ioapics)
+	if (!skip_ioapic_setup && nr_ioapics) {
 		setup_IO_APIC();
+	} else
+		nr_ioapics = 0;
 #endif
 
 	/*
