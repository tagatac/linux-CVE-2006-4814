--- linux-2.4.20/init/main.c.nousb	2003-04-25 11:44:24.000000000 -0400
+++ linux-2.4.20/init/main.c	2003-04-25 11:44:27.000000000 -0400
@@ -148,6 +148,15 @@ static int __init profile_setup(char *st
 
 __setup("profile=", profile_setup);
 
+int disable_all_usb = 0;
+static int __init no_usb(char * s)
+{
+	disable_all_usb = 1;
+	return 1;
+}
+__setup("nousb", no_usb);
+
+
 static int __init checksetup(char *line)
 {
 	struct kernel_param *p;
--- linux-2.4.20/kernel/ksyms.c.nousb	2003-04-25 11:44:24.000000000 -0400
+++ linux-2.4.20/kernel/ksyms.c	2003-04-25 11:45:09.000000000 -0400
@@ -528,6 +528,8 @@ EXPORT_SYMBOL(seq_read);
 EXPORT_SYMBOL(seq_lseek);
 EXPORT_SYMBOL(single_open);
 EXPORT_SYMBOL(single_release);
+extern int disable_all_usb;
+EXPORT_SYMBOL(disable_all_usb);
 
 /* Program loader interfaces */
 EXPORT_SYMBOL(setup_arg_pages);
--- linux-2.4.20/drivers/usb/host/ehci-hcd.c.nousb	2003-04-25 11:43:58.000000000 -0400
+++ linux-2.4.20/drivers/usb/host/ehci-hcd.c	2003-04-25 11:44:27.000000000 -0400
@@ -1037,8 +1037,11 @@ MODULE_DESCRIPTION (DRIVER_INFO);
 MODULE_AUTHOR (DRIVER_AUTHOR);
 MODULE_LICENSE ("GPL");
 
+extern int disable_all_usb;
 static int __init init (void) 
 {
+	if (disable_all_usb)
+		return -ENODEV;
 	dbg (DRIVER_INFO);
 	dbg ("block sizes: qh %Zd qtd %Zd itd %Zd sitd %Zd",
 		sizeof (struct ehci_qh), sizeof (struct ehci_qtd),
--- linux-2.4.20/drivers/usb/host/uhci.c.nousb	2003-04-25 11:43:59.000000000 -0400
+++ linux-2.4.20/drivers/usb/host/uhci.c	2003-04-25 11:44:27.000000000 -0400
@@ -3099,10 +3099,14 @@ static struct pci_driver uhci_pci_driver
 #endif	/* PM */
 };
 
+extern int disable_all_usb; 
  
 static int __init uhci_hcd_init(void)
 {
 	int retval = -ENOMEM;
+	
+	if (disable_all_usb)
+		return -ENODEV;
 
 	info(DRIVER_DESC " " DRIVER_VERSION);
 
--- linux-2.4.20/drivers/usb/host/usb-ohci.c.nousb	2003-04-25 11:44:11.000000000 -0400
+++ linux-2.4.20/drivers/usb/host/usb-ohci.c	2003-04-25 11:44:27.000000000 -0400
@@ -2937,9 +2937,12 @@ static struct pci_driver ohci_pci_driver
 
  
 /*-------------------------------------------------------------------------*/
+extern int disable_all_usb;
 
 static int __init ohci_hcd_init (void) 
 {
+	if (disable_all_usb)
+		return -ENODEV;
 	return pci_module_init (&ohci_pci_driver);
 }
 
--- linux-2.4.20/drivers/usb/host/usb-uhci.c.nousb	2003-04-25 11:43:59.000000000 -0400
+++ linux-2.4.20/drivers/usb/host/usb-uhci.c	2003-04-25 11:44:27.000000000 -0400
@@ -3091,10 +3091,14 @@ static struct pci_driver uhci_pci_driver
 };
 
 /*-------------------------------------------------------------------------*/
+extern int disable_all_usb;
 
 static int __init uhci_hcd_init (void) 
 {
 	int retval;
+	
+	if (disable_all_usb)
+		return -ENODEV;
 
 #ifdef DEBUG_SLAB
 	urb_priv_kmem = kmem_cache_create("urb_priv", sizeof(urb_priv_t), 0, SLAB_HWCACHE_ALIGN, NULL, NULL);
