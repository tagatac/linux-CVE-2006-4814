diff -urN -X dontdiff linux-2.4.20-1.1931.2.199.z0/fs/partitions/ibm.c linux-2.4.20-1.1931.2.199.z1/fs/partitions/ibm.c
--- linux-2.4.20-1.1931.2.199.z0/fs/partitions/ibm.c	2002-08-02 20:39:45.000000000 -0400
+++ linux-2.4.20-1.1931.2.199.z1/fs/partitions/ibm.c	2003-05-22 19:31:04.000000000 -0400
@@ -30,6 +30,10 @@
 #include "check.h"
 #include <asm/vtoc.h>
 
+#if CONFIG_BLK_DEV_MD
+extern void md_autodetect_dev(kdev_t dev);
+#endif
+
 /*
  * compute the block number from a 
  * cyl-cyl-head-head structure
@@ -173,6 +177,7 @@
 		while ((data = read_dev_sector(bdev, blk*(blocksize/512),
 					       &sect)) != NULL) {
 			format1_label_t f1;
+			char *ch;
 
 			memcpy(&f1, data, sizeof(format1_label_t));
 			put_dev_sector(sect);
@@ -198,6 +203,17 @@
 			add_gd_partition(hd, first_part_minor + counter, 
 					 offset * (blocksize >> 9),
 					 size * (blocksize >> 9));
+
+#ifdef CONFIG_BLK_DEV_MD
+			/* Corrupting the label buffer now to save the stack. */
+			EBCASC(f1.DS1DSNAM, 44);
+			f1.DS1DSNAM[44] = 0;
+			ch = strstr(f1.DS1DSNAM, "PART");
+			if (ch != NULL && strncmp(ch + 9, "RAID  ", 6) == 0) {
+				md_autodetect_dev(MKDEV(
+				    hd->major, first_part_minor + counter));
+			}
+#endif
 			counter++;
 			blk++;
 		}
