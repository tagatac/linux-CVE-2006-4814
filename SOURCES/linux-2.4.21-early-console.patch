--- linux-2.4.20/arch/ppc64/kernel/setup.c.orig	2003-04-10 12:55:20.000000000 -0400
+++ linux-2.4.20/arch/ppc64/kernel/setup.c	2003-04-10 13:00:51.000000000 -0400
@@ -45,6 +45,7 @@ extern unsigned long klimit;
 /* extern void *stab; */
 extern HTAB htab_data;
 extern unsigned long loops_per_jiffy;
+extern int preferred_console;  /* from kernel/printk.c */
 extern int blk_nohighio;
 
 extern unsigned long embedded_sysmap_start;
@@ -146,6 +143,7 @@ void setup_system(unsigned long r3, unsi
 
 	if (systemcfg->platform & PLATFORM_PSERIES) {
 		register_console(&udbg_console);
+		preferred_console = -1;
 		udbg_printf("---- start early boot console ----\n");
 	}
 
@@ -191,8 +189,10 @@ void setup_system(unsigned long r3, unsi
 void setup_before_console_init(void)
 {
 	if (systemcfg->platform & PLATFORM_PSERIES) {
+		int save = preferred_console;
 		unregister_console(&udbg_console);
 		udbg_console.next = NULL;
+		preferred_console = save;
 		udbg_printf("---- end early boot console ----\n");
 	}
 }
diff -Naurp linux-orig/kernel/printk.c linux-2.4.20/kernel/printk.c
--- linux-orig/kernel/printk.c	Wed Apr  9 08:26:32 2003
+++ linux-2.4.20/kernel/printk.c	Wed Apr  9 08:34:01 2003
@@ -92,7 +92,7 @@ static unsigned long log_end;			/* Index
 static unsigned long logged_chars;		/* Number of chars produced since last read+clear operation */
 
 struct console_cmdline console_cmdline[MAX_CMDLINECONSOLES];
-static int preferred_console = -1;
+int preferred_console = -1;
 
 /* Flag: console code may call schedule() */
 static int console_may_schedule;
