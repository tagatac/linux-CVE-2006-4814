diff -urNp linux-1070/arch/i386/mm/init.c linux-1080/arch/i386/mm/init.c
--- linux-1070/arch/i386/mm/init.c
+++ linux-1080/arch/i386/mm/init.c
@@ -310,14 +310,35 @@ void __init zap_low_mappings(void)
 unsigned long long __PAGE_KERNEL = _PAGE_KERNEL;
 unsigned long long __PAGE_KERNEL_EXEC = _PAGE_KERNEL_EXEC;
 
+#if CONFIG_HIGHMEM64G
+#define MIN_ZONE_DMA_PAGES 1024
+#else
+#define MIN_ZONE_DMA_PAGES 4096
+#endif
+
 static void __init zone_sizes_init(void)
 {
 	unsigned long zones_size[MAX_NR_ZONES] = {0, 0, 0};
-	unsigned int max_dma, high, low;
+	unsigned int max_dma, ratio_maxdma, high, low;
 
 	max_dma = virt_to_phys((char *)MAX_DMA_ADDRESS) >> PAGE_SHIFT;
 	low = max_low_pfn;
 	high = highend_pfn;
+	
+	/*
+	 * Make the DMA zone 5% of memory, with a minimum of 4Mb
+	 * and a maximum of 16Mb.
+	 */
+	#if MAX_ORDER != 10
+	#error fix this
+	#endif
+	ratio_maxdma = (highend_pfn / 20) & ~((1 << MAX_ORDER)-1); 
+	if (ratio_maxdma > max_dma)
+		ratio_maxdma = max_dma;
+	if (ratio_maxdma < MIN_ZONE_DMA_PAGES)
+		ratio_maxdma = MIN_ZONE_DMA_PAGES;
+		
+	max_dma = ratio_maxdma;
 
 	if (low < max_dma)
 		zones_size[ZONE_DMA] = low;
diff -urNp linux-1070/mm/page_alloc.c linux-1080/mm/page_alloc.c
--- linux-1070/mm/page_alloc.c
+++ linux-1080/mm/page_alloc.c
@@ -38,11 +38,19 @@ zone_t *zone_table[MAX_NR_ZONES*MAX_NR_N
 EXPORT_SYMBOL(zone_table);
 
 static char *zone_names[MAX_NR_ZONES] = { "DMA", "Normal", "HighMem" };
+#if defined(CONFIG_HIGHMEM64G) || defined(CONFIG_X86_64)
+static int zone_balance_ratio[MAX_NR_ZONES] __initdata = { 4097, 128, 128, };
+static int zone_balance_min[MAX_NR_ZONES] __initdata = { 0 , 20, 20, };
+static int zone_balance_max[MAX_NR_ZONES] __initdata = { 0 , 255, 255, };
+static int zone_extrafree_ratio[MAX_NR_ZONES] __initdata = { 4097, 512, 0, };
+static int zone_extrafree_max[MAX_NR_ZONES] __initdata = { 0 , 1024, 0, };
+#else
 static int zone_balance_ratio[MAX_NR_ZONES] __initdata = { 128, 128, 128, };
 static int zone_balance_min[MAX_NR_ZONES] __initdata = { 20 , 20, 20, };
 static int zone_balance_max[MAX_NR_ZONES] __initdata = { 255 , 255, 255, };
 static int zone_extrafree_ratio[MAX_NR_ZONES] __initdata = { 128, 512, 0, };
 static int zone_extrafree_max[MAX_NR_ZONES] __initdata = { 1024 , 1024, 0, };
+#endif
 
 /*
  * Temporary debugging check.
@@ -867,6 +875,9 @@ static inline void build_zonelists(pg_da
 				zone = pgdat->node_zones + ZONE_NORMAL;
 				if (zone->size)
 					zonelist->zones[j++] = zone;
+#if defined(CONFIG_HIGHMEM64G) || defined(CONFIG_X86_64)
+				break;
+#endif				
 			case ZONE_DMA:
 				zone = pgdat->node_zones + ZONE_DMA;
 				if (zone->size)
